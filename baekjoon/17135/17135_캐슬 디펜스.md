# 캔슬 디펜스
> 출처: 백준 온라인 저지 17135

## 1. 문제 정보
### 1.1 문제
캐슬 디펜스는 성을 향해 몰려오는 적을 잡는 턴 방식의 게임이다. 게임이 진행되는 곳은 크기가 N×M인 격자판으로 나타낼 수 있다. 격자판은 1×1 크기의 칸으로 나누어져 있고, 각 칸에 포함된 적의 수는 최대 하나이다. 격자판의 N번행의 바로 아래(N+1번 행)의 모든 칸에는 성이 있다.

성을 적에게서 지키기 위해 궁수 3명을 배치하려고 한다. 궁수는 성이 있는 칸에 배치할 수 있고, 하나의 칸에는 최대 1명의 궁수만 있을 수 있다. 각각의 턴마다 궁수는 적 하나를 공격할 수 있고, 모든 궁수는 동시에 공격한다. 궁수가 공격하는 적은 거리가 D이하인 적 중에서 가장 가까운 적이고, 그러한 적이 여럿일 경우에는 가장 왼쪽에 있는 적을 공격한다. 같은 적이 여러 궁수에게 공격당할 수 있다. 공격받은 적은 게임에서 제외된다. 궁수의 공격이 끝나면, 적이 이동한다. 적은 아래로 한 칸 이동하며, 성이 있는 칸으로 이동한 경우에는 게임에서 제외된다. 모든 적이 격자판에서 제외되면 게임이 끝난다. 

게임 설명에서 보다시피 궁수를 배치한 이후의 게임 진행은 정해져있다. 따라서, 이 게임은 궁수의 위치가 중요하다. 격자판의 상태가 주어졌을 때, 궁수의 공격으로 제거할 수 있는 적의 최대 수를 계산해보자.

격자판의 두 위치 (r1, c1), (r2, c2)의 거리는 |r1-r2| + |c1-c2|이다.

### 1.2 입력
첫째 줄에 격자판 행의 수 N, 열의 수 M, 궁수의 공격 거리 제한 D가 주어진다. 둘째 줄부터 N개의 줄에는 격자판의 상태가 주어진다. 0은 빈 칸, 1은 적이 있는 칸이다.  
3 ≤ N, M ≤ 15  
1 ≤ D ≤ 10

### 1.3 출력
첫째 줄에 궁수의 공격으로 제거할 수 있는 적의 최대 수를 출력한다.

- 예제 입력

6 5 2  
1 0 1 0 1  
0 1 0 1 0  
1 1 0 0 0  
0 0 0 1 1  
1 1 0 1 1  
0 0 1 0 0  

- 예제 출력

14

## 2. 문제 분석
### 2.1 얻을 수 있는 정보
- 게임에서 총 턴수
- 각 턴마다 잡을 수 있는 최대 적수
- 게임에서 잡을 수 있는 최대 적수
- 궁수의 사정범위와 사정 우선순위
- 궁수 3명의 위치의 경우의 수

### 2.2 정보의 특징
- 공격이 끝나면 적은 아래로 한칸 이동하기에, 게임의 총 턴수는 N이다.
- 궁수는 총 3명이기에, 각 턴마다 최대 3명의 적을 잡을 수 있고, 적이 서로 다른 위치에 있어야한다. 때문에 게임에서는 0 ~ 3xN만큼의 적을 잡을 수 있다.
- 궁수의 사정범위는 2xd-1 만큼 있고, 가장 가까운 적 부터 시작하고, 가장 왼쪽의 적부터 사격한다. 즉 궁수의 위치가 N+1, M일 경우, 각 위치의 -1 부터 시작해서 사격한다.
- 첫번째 궁수의 위치를 M의 0부터 -1까지 점진적으로 이동하는 방식으로 경우의 수를 계산할 수 있는데, 나머지 두 궁수의 위치는 서로 중복이 될수 없기 때문에 첫 궁수가 0에서는 ((M-1)/2) * (M-2)만큼의 경우의 수를 갖고, -1에서는 1만큼의 경우의 수를 추가로 갖는다. 이과정에서 궁수의 위치의 경우의 수를 구할 수 있다.

## 3. 문제 해결
궁수 3명으로 최대한 많은 적을 잡기 위해서는, 궁수들 간의 시너지 효과를 최대한 발휘해야한다. 각턴에 모든 궁수는 동시공격하여 같은 적이 여러 궁수에게 공격당할 수 있고, 턴이 끝날때 공격받은 적이 게임에서 제외되기 때문이다. 궁수들이 위치할 수 있는 모든 위치에서 각각이 아닌 3명을 동시에 측정해야 정확하게 게임에서 제거할 수 있는 적의 수를 알 수 있다.

궁수의 위치는 겹치거나 중복이 안되는 조합이다. 즉 0,1,2나 0,2,1은 같은 위치의 값이다. M이 7이고 첫번째 궁수의 위치가 0일 경우 두번째 궁수의 위치는 1,2,3,4,5가 될 수 있으며, 세번째 궁수는 첫번째 궁수와 두번째 궁수의 위치와 겹치지 않는 위치를 갖고 이를 나열하여 확인하면 총 15개의 경우의 수가 있다.  
(M-2)부터 1까지의 합이고, 이를 등차수열의 합으로 계산을 간략화하면 (M-1/2) * M-2이다.  
a+b=M-2가 될 수 있는 a,b의 순열은 M-1개 있고, 이중에 a와 b가 중복되는 경우인 절반을 나누고 M-2를 곱해주면 된다. 즉 M-2가 될 수 있는 순열 x M-2가 등차수열의 합이라고 보면 된다.  
첫 궁수의 위치는 점진적으로 이동하면서 중복으로 등장하는 위치가 늘어날 것이기에, 첫 궁수의 위치가 1일 때는 ((M-2)/2) * (M-3)의 경우의 수가 있을 것이다. 그리고 첫 궁수가 -1의 위치에 도달했을 때는 경우의 수는 1개만 있을 것이다. 첫 궁수의 모든 위치에서의 경우의 수를 합하면 전체 게임에서 3 궁수 위치의 경우의 수를 구할 수 있다. (nCr 조합 경우의수로 계산해도 된다)  
문제 해결을 위해 경우의 수보다는 위치 값을 갖고 있어야하는데, 첫번째 궁수의 위치는 0부터 M-2까지 루프를 통해 하나식 이동하고, 두번째 궁수의 위치는 이중 루프를 통해 첫 궁수의 위치+1부터 M-1까지 이동을 하며, 세번째 궁수의 위치는 삼중 루프를 통해 두번째 궁수의 위치+1부터 M까지 이동을 한다.  

궁수의 사정거리 d는 |r1-r2| + |c1-c2| 이를 간략화하면 a+b=d가 된다. a와 b의 순열은 총 d+1개 만큼 갖고 있다.  
d+1개 만큼 갖고 있지만, 0은 마이너스가 없기에 우선 제외하면, d-1개의 값이 되고, 적의 위치는 성 밖이라는 점에서, a는 항상 마이너스고, b는 플러스 마이너스가 될 수 있다. (마이너스가 왼쪽이기에 우선순위임) 2x(d-1)개의 경우를 갖고 0을 포함한 경우중 성 밖을 가리키는 단하나의 경우만 포함한면 2x(d-1)+1의 경우를 갖는다.  
d가 주어질때 궁수는 거리가 가까운 적부터 제거하기에, 1부터 d까지 점진적으로 이동하면서 사정거리내에 적이 있다면 제거를 한다. 사정범위는 한번의 계산만하여 리스트에 저장하는 방식으로 수행시간을 단축시킬수 있다.  
사정범위는 궁수의 위치를 구하는 조합과 거이 동일하다고 보면 된다. 다만 순열이고, 마이너스부터 순열을 구하다가 0+d=d 시점에서 플러스 순열로 전환된다.  
순열을 구할때 지켜야하는 건 b는 마이너스부터 시작해야하고, a는 작은 값에서 큰 값으로 이동해야한다. 이는 궁수가 왼쪽부터 제거하는 특성때문이다.  

N×M판은 기록을 위해 부분적으로 두번 복사하며 기록해야한다.  
같은 적을 쏠수 있기에 쐈던 적은 1대신 2로 기록하여, 다음 궁수가 2의 적을 쏘면 카운트를 하지 않는다.  
궁수가 제거한 적은 턴이 끝나면 0으로 기록한다. 궁수의 위치가 바뀌면 다시 기존의 판으로 교체한다.  

- 알고리즘 기법
  - 순열과 조합을 효율적으로 찾을 수 있는 알고리즘
